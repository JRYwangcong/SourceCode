C51 COMPILER V9.00   MDRV_MHL                                                              07/03/2017 18:41:22 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE MDRV_MHL
OBJECT MODULE PLACED IN .\Obj\mdrv_mhl.obj
COMPILER INVOKED BY: C:\Keil4\C51\BIN\C51.EXE ..\Code\mdrv_mhl.c OPTIMIZE(9,SPEED) BROWSE INCDIR(..\Code\INC;..\Code\DRI
                    -VER\INC;..\Code\DRIVER\MST9U\INC;..\Code\DRIVER\MST9U3\INC) DEFINE(ModelName=MST9U3_DEMO,CHIP_ID=MST9U3) DEBUG OBJECTEXT
                    -END PRINT(.\List\mdrv_mhl.lst) OBJECT(.\Obj\mdrv_mhl.obj)

line level    source

   1          ///////////////////////////////////////////////////////////////////////////////////////////////////
   2          ///
   3          /// file    mdrv_mhl.c
   4          /// @author MStar Semiconductor Inc.
   5          /// @brief  MHL driver Function
   6          ///////////////////////////////////////////////////////////////////////////////////////////////////
   7          
   8          #ifndef _MDRV_MHL_C_
   9          #define _MDRV_MHL_C_
  10          
  11          //-------------------------------------------------------------------------------------------------
  12          //  Include Files
  13          //-------------------------------------------------------------------------------------------------
  14          #include "Global.h"
  15          #include <string.h>
  16          #include "mapi_mhl.h"
  17          #include "mhal_mhl.h"
  18          #include "mdrv_mhl.h"
  19          
  20          //-------------------------------------------------------------------------------------------------
  21          //  Local Defines
  22          //-------------------------------------------------------------------------------------------------
  23          #define MHL_DRV_DEBUG_MESSAGE           1
  24          #define MHL_DEBUG_RX_RECEIVE_DATA       0
  25          
  26          #if(MHL_DEBUG_MESSAGE & MHL_DRV_DEBUG_MESSAGE)
              #define MHL_DRV_DPUTSTR(str)            printMsg(str)
              #define MHL_DRV_DPRINTF(str, x)         printData(str, x)
              #else
  30          #define MHL_DRV_DPUTSTR(str)
  31          #define MHL_DRV_DPRINTF(str, x)
  32          #endif
  33          
  34          #if(MHL_DEBUG_RX_RECEIVE_DATA)
              #define MHL_DRV_RXDEBUG(str, x)         MHL_DRV_DPRINTF(str, x)
              #else
  37          #define MHL_DRV_RXDEBUG(str, x)
  38          #endif
  39          
  40          //-------------------------------------------------------------------------------------------------
  41          //  Local Structures
  42          //-------------------------------------------------------------------------------------------------
  43          
  44          //-------------------------------------------------------------------------------------------------
  45          //  Global Variables
  46          //-------------------------------------------------------------------------------------------------
  47          
  48          //-------------------------------------------------------------------------------------------------
  49          //  Local Variables
  50          //-------------------------------------------------------------------------------------------------
  51          BYTE ucMHLCbusConnect = 0;
  52          
  53          //-------------------------------------------------------------------------------------------------
C51 COMPILER V9.00   MDRV_MHL                                                              07/03/2017 18:41:22 PAGE 2   

  54          //  Local Functions
  55          //-------------------------------------------------------------------------------------------------
  56          
  57          //-------------------------------------------------------------------------------------------------
  58          //  Global Functions
  59          //-------------------------------------------------------------------------------------------------
  60          
  61          //**************************************************************************
  62          //  [Function Name]:
  63          //                  mdrv_mhl_SetPowerStatus()
  64          //  [Description]
  65          //
  66          //  [Arguments]:
  67          //
  68          //  [Return]:
  69          //
  70          //**************************************************************************
  71          void mdrv_mhl_SetPowerStatus(BYTE ucPowerStatus)
  72          {
  73   1          mhal_mhl_SetPowerStatus(ucPowerStatus);
  74   1      
  75   1          CLR_MHL_CBUS_CONNECT_PORT_ALL();
  76   1      }
  77          
  78          //**************************************************************************
  79          //  [Function Name]:
  80          //                  mdrv_mhl_SetPowerStatus()
  81          //  [Description]
  82          //
  83          //  [Arguments]:
  84          //
  85          //  [Return]:
  86          //
  87          //**************************************************************************
  88          void mdrv_mhl_TimerHandler(void)
  89          {
  90   1          mhal_mhl_TimerHandler();
  91   1      }
  92          
  93          //**************************************************************************
  94          //  [Function Name]:
  95          //                  mdrv_mhl_CbusWakeupDetect()
  96          //  [Description]
  97          //
  98          //  [Arguments]:
  99          //
 100          //  [Return]:
 101          //
 102          //**************************************************************************
 103          Bool mdrv_mhl_CbusWakeupDetect(BYTE ucPortSelect)
 104          {
 105   1          Bool bCbusConnect = FALSE;
 106   1      
 107   1          mhal_mhl_PMStatePolling(ucPortSelect);
 108   1      
 109   1          bCbusConnect = mhal_mhl_CbusConnectStatus(ucPortSelect);
 110   1          
 111   1          if(GET_MHL_CBUS_CONNECT_PORT(ucPortSelect) != bCbusConnect)
 112   1          {
 113   2              if(bCbusConnect)
 114   2              {
 115   3                  // Enable Rterm control SW mode
C51 COMPILER V9.00   MDRV_MHL                                                              07/03/2017 18:41:22 PAGE 3   

 116   3                  mhal_mhl_ComboRtermControl(ucPortSelect, RX_MHL_RTERM);
 117   3                  // Disable Rterm control HW mode
 118   3                  mhal_mhl_RtermControlHWMode(ucPortSelect, FALSE);
 119   3      
 120   3                  SET_MHL_CBUS_CONNECT_PORT(ucPortSelect);
 121   3              }
 122   2              else if(GET_MHL_CBUS_CONNECT_PORT(ucPortSelect))
 123   2              {
 124   3                  // Disable Rterm control SW mode
 125   3                  mhal_mhl_ComboRtermControl(ucPortSelect, RX_RTERM_OFF);
 126   3                  // Enable Rterm control HW mode
 127   3                  mhal_mhl_RtermControlHWMode(ucPortSelect, TRUE);
 128   3                  
 129   3                  CLR_MHL_CBUS_CONNECT_PORT(ucPortSelect);
 130   3              }
 131   2          }
 132   1      
 133   1          return bCbusConnect;
 134   1      }
 135          
 136          #endif // _MDRV_MHL_C_
 137          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    152    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
